<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>

    <script src="signalr.min.js"></script>
    <script src="jquery.min.js"></script>

    <script>
        $(document).ready(() => {
            const connection = new signalR.HubConnectionBuilder()
            .withUrl("http://localhost:5000/chathub")
            .withAutomaticReconnect()  // ->> Server ile connection olub sonradan qopduqu caselerde 
                                                //Bu function mueyyen araliqlarla connection etmeye calisir
            .build();


            // Server ile connectionun hec qurulmadiqi caselerde asaqidaki function ile 
            // mueyyen time intervalinda connection etmeye calisir .Recursive bir function olmalidir.

            async function start(){
                try {
                   await connection.start();
                } catch (error) {
                    setTimeout(() => start(), 3000);
                }
            }
            
            start();
            // connection.start();

            $("#btn__sendMessage").click(() => {
                let message = $("#txt__message").val();
                connection.invoke("SendMessageAsync" , message)
                .catch(error => console.log(`An error occurred while sending the message : ${error}`));
            })

            connection.on("receiveMessage" , message => {
                $("div").append(message + "<br/>");
            })

             


        });

    </script>
</head>
<body>

    <input type="text" id="txt__message">

    <button id="btn__sendMessage"> Send </button>
    
    <div>

    </div>

</body>
</html>